# ⚠️ Project in progress... ⚠️

`ptero.client` - its half completed. not all functions available  
`ptero.servers` - in development...  
`ptero.users` - in development...

# 🐦 Wrapdactyl
Do you know that moment when your scripts are very messy and full of api calls to your pterodactyl panel? Well this is not a problem anymore because wrapdactyl is here. Wrapdactyl is a pterodactyl wrapper which allows you to make api calls by running simple functions. [More info about options here](https://github.com/JustArtiom/wrapdactyl#%EF%B8%8F-options)

# 📥 Installation
```
npm install wrapdactyl
```

# 🔧 How to use
Wrapdactyl is a class that requires some parameters in such as panel url client api key and application api key. It could also be customised by setting some options in order to add or remove functions to make your code maximum optimised.
```js
const wrapdactyl = require('wrapdactyl');

const ptero = new wrapdactyl({
    url: 'https://panel.domain.com',    // Panel url
    client: 'ptlc_...',                 // Client api key
    application: 'ptla_...',            // Application api key
    options: {                      // Options to optimise the performance
        cache: true,                // Enable or disable cache
        events: true,               // Enable of disable events
        checkInterval: 5000,        // An interval which checks the status of tokens and panel
        updateCacheInterval: 30000  // An interval which updates cache in case you have it enabled
    }
})
```
Even if you did the configuration the pterowrapper is not ready to use yet because it has to go trough a check which can be made by calling the async function `check()` which returns a promise with the status and ping of the pterodactyl panel and the status of the configured api keys.
```js
ptero.check().then(data => {
    console.log('pterodactyl wrapper is ready');
    console.log(data)
})
```
The option `checkInterval` offers you the opotunity to check the configuration in an interval of time  
Now the wrapper is ready to use! have fun with it 👍

# 💻 How cache works
*⚠️Warning: This function spams your panel api*  
Cache is a hardware or software component that stores data so that future requests for that data can be served faster. In this case cache can be used only if the option cache is enabled (`cache: true`). Cache can be stored at the begging of the code by running the `updateCache()` async function which returns boolean that tells if the cache process is complete or not.

```js
ptero.updateCache().then(() => {
    console.log('cache has been updated')
    
    // Now you have access to
    ptero.users.cache.get('user id');
    ptero.servers.cache.get('server id');
})
```
Cache isnt always up to date since you can make modifications manually to the servers and/or users, so thats why there is an option called `updateCacheInterval` which can be set in miliseconds to update the cache in an interval of time.  

# 📅 How events work
Events are actions or occurrences that happen in the system you are programming, which the system tells you about so your code can react to them. To listen to an wrapdactyl event you will have enable `events` in options and run the function `on()` which will take a string as first value, beeing the event name and a callback.
```js
ptero.on('Event Name', (data) => console.log(data));
```
Event Name | Callback input | Description
--- | --- | ----
checkUpdate | 1 value | This event runs only when `checkInterval` is configured. It runs the callback when the interval makes a check and returns the status and ping of the panel aswell and the api keys status
cacheUpdate | null | This events runs only when `updateCacheInterval` is configured, and it runs when the interval of time set updates the cache.  

**Example:**
```js
ptero.on('checkUpdate', (data) => {
    console.log('A check has been made!')
    console.log(data)
});
```

# 📕 Client Functions

**Show permissions:**  
Retries all available permissions
```js
ptero.client.permissions()
```

**Account details:**  
Retrieves information about the account
```js
ptero.client.account.fetch()
```

**Update email:**  
Updates the password of the account  
- Value 1 - Required - the new email which you want to change into
- Value 2 - Required - password of the account
```js
ptero.client.account.updateEmail('newemail@gmail.com', 'password')
```

**Update password:**  
Updates the email address of the account  
- Value 1 - Required - The password of the account
- Value 2 - Required - The new password which you want to change into
```js
ptero.client.account.updatePassword('password', 'newpassword')
```

**Two-Factor Authentication details:**  
Generates a TOTP QR code image to allow the setup of 2FA
```js
ptero.client.account.twofa.fetch()
```

**Enable Two-Factor Authentication:**  
Enables TOTP 2FA using the QR code generated by the function above  
- Value 1 - Required - The password of the account
- Value 2 - Required - The 2fa code generated by Authenticator app
```js
ptero.client.account.twofa.enable('password', '2fa code')
```

**Disable Two-Factor Authentication:**  
Disables TOTP 2FA on the account  
- Value 1 - Required - Password of the account
```js
ptero.client.account.twofa.disable('password')
```

**Disable Two-Factor Authentication:**  
Disables TOTP 2FA on the account  
- Value 1 - Required - Password of the account
```js
ptero.client.account.twofa.disable('password')
```

**List API keys:**  
Retries a list of API keys  
```js
ptero.client.account.apikeys.fetch()
```

**Create API key:**  
Generates a new API key  
- Value 1 - Required - Name of the api key you want to generate
- Value 2 - Nullable - The white list ips
```js
ptero.client.account.apikeys.create('name', ['127.0.0.1'])
```

**Delete API key:**  
Deletes the specified API key
- Value 1 - Required - The api key identifier
```js
ptero.client.account.apikeys.delete('apikey')
```

**Server List:**  
List all your servers
```js
ptero.client.servers.fetchAll()
```

**Server details:**  
Retrieves information about the specified server
- Value 1 - Required - Server id
- Value 2 - Nullable - Object - Optimise code performance
    - egg: true - Information about the egg the server uses
    - subusers: true - List of subusers on the server
```js
ptero.client.servers.fetch('server id', { egg: true, subusers: true });
```

**Server Console details:**  
Generates credentials to establish a websocket
- Value 1 - Required - Server id
```js
ptero.client.servers.consoleDetails('server id')
```

**Server websocket:**  
Connect to the server websocket

- Value 1 - Required - Object - Details to establish the websocket  
      *These can be requested from `ptero.client.servers.consoleDetails`*
    - Origin - Required - The panel URL
    - Token - Required - The token for authentication
    - Socket - Required - The actual websocket destination

```js
let websocket_details = await ptero.client.servers.consoleDetails("server id");
let server = new ptero.client.servers.websocket(websocket_details);

// What you can listen to
server.on('connected', async () => {
    console.log('connected')

    // What you can send to the server
    server.power('start'); // start / restart / stop / kill
    server.send('command');
    server.request.logs();
    server.request.stats();
    
    // Close the websocket
    server.close()
});
server.on('status', (status) => console.log(status));
server.on('stats', (stats) => console.log(stats));
server.on('console', (message) => console.log(message));
server.on('deamonError', (message) => console.log(message));

server.on('expiring', (auth) => {
    console.log('Token is about to expire');
    // send a new token to keep the connection alive
    // A new token can be requested by running ptero.client.servers.consoleDetails
    auth("new token");
});
server.on('expired', () => console.log('Token had expired'));
server.on('disconnected', () => console.log('server disconnected'));

// Connect to the server
server.connect().catch(err => console.log(err));
```
The function `server.connect()` is an async function that returns "true" if connected and throws an error in case it couldnt connect to the websocket. **It is preferable to put this function at the bottom, before you listen to events if you are going to await the function** otherwise it wont triger the event "connected".  
Here is an example how await connect function could help:
```js
server.on('connected', () => console.log('Server connected'))

await server.connect();
server.power('start');
server.send('command');
server.request.logs();
server.request.stats();
```
**Server Resource usage:**  
Retrieves resource utilization of the specified server  
- Value 1 - Required - Server id
```js
ptero.client.servers.resources('server id')
```

**Send command to the server:**  
Sends a command to the server. The server must be online to send a command to it.
- Value 1 - Required - Server id
- Value 2 - Required - Command string
```js
ptero.client.servers.sendCommand('server id', 'command')
```

**Change server power state:**  
Sends a power signal to the server  
- Value 1 - Required - Server id
- Value 2 - Required - Can be only: start, restart, stop, kill
```js
ptero.client.servers.power('server id', 'start')
```
#
```
⏩ Skipped a lot of functions for the future versions.
```
#

**Rename server:**  
Renames the server  
- Value 1 - Required - Server id
- Value 2 - Required - New Name of the server
```js
ptero.client.servers.rename('server id', 'name')
```

**Reinstall server:**  
Reinstalls the server
- Value 1 - Required - Server id
```js
ptero.client.servers.reinstall('server id')
```

# 📙 Application functions


# ⚠️ To-Do List

✅ - completed  
⏩ - skipped for later

**Application functions:**  
```js
```

# ⚙️ Options
soon
